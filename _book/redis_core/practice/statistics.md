# 集合统计

## 聚合统计

需要对多个集合进行聚合计算时，Set类型会是一个非常不错的选择。但是有一个潜在的风险：Set的差集、并集和交集的计算复杂度较高，因此数据量很大时直接执行这些计算，会导致redis实例阻塞。

建议：**可以从主从集群中选择一个从库，让它专门负责聚合计算，或者是把数据读取到客户端，在客户端来完成聚合统计**

## 排序统计

List是按照元素进入List的顺序进行排序的，而Sorted Set可以根据元素的权重来排序

- List：对比新元素插入前后，List相同位置上的元素就会发生变化，用LRANGE读取时，就会读到旧元素
- Sorted Set：如果数据更新频繁或者需要分页显示，建议你优先考虑使用Sorted Set。

## 二值状态统计

可以选择Bitmap。这是Redis提供的扩展数据类型

Bitmap本身是用String类型作为底层数据结构实现的一种统计二值状态的数据类型。String类型是会保存为二进制的字节数组，所以，Redis就把字节数组的每个bit位利用起来，用来表示一个元素的二值状态。可以把Bitmap看作是一个bit数组。

## 基数统计

基数统计就是指统计一个集合中不重复的元素个数。

用Hash和Set可以实现，但是数据量很大时，会消耗很多空间。

HyperLogLog是一种用于统计基数的数据集合类型

- 优势：当集合元素数量非常多时，它计算基数所需的空间总是固定的，而且还很小。
- 劣势：统计结果是有一定误差，标准误算率是0.81%

## 总结

数据类型|聚合统计|排序统计|二值统计|基数统计
:--:|:--:|:--:|:--:|:--:
Set|支持差集、交集、并集计算|不支持|不支持|精确统计，大数据量时，效率低，内存开销大
Sorted Set|支持交集、并集计算|支持|不支持|精确统计，大数据量时，效率低，内存开销大
Hash|不支持|不支持|不支持|精确统计，大数据量时，效率低，内存开销大
List|不支持|支持|不支持|不支持、元素没有去重
Bitmap|与、或、异或计算|不支持|支持，大数据量时，效率高，省内存|精确统计，内存开销大于HyperLogLog
HyperLogLog|不支持|不支持|不支持|概率统计、大数据量时，很节省内存